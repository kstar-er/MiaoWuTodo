
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{team_name}} - å¼€å‘å‘¨æŠ¥</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; margin: 0; padding: 0; }
        body { background-color: #f5f7fa; color: #333; padding: 20px; line-height: 1.6; }
        .report-container { max-width: 1000px; margin: 20px auto; background: white; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); padding: 30px; }
        header { border-bottom: 2px solid #eaeaea; padding-bottom: 20px; margin-bottom: 25px; }
        h1 { color: #2c3e50; }
        .meta { color: #7f8c8d; margin-top: 8px; font-size: 0.95em; }
        .period { background: #e8f4fc; padding: 3px 8px; border-radius: 4px; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 25px 0; }
        .metric-card { background: #f8fafc; border-left: 4px solid #3498db; padding: 15px; border-radius: 6px; }
        .metric-card.critical { border-left-color: #e74c3c; }
        .metric-value { font-size: 2em; font-weight: bold; color: #2c3e50; }
        .metric-desc { font-size: 0.9em; color: #666; margin-top: 5px; }
        .section { margin: 30px 0; }
        h2 { color: #34495e; padding-bottom: 10px; border-bottom: 1px dashed #ddd; margin-bottom: 15px; }
        .task-list { list-style: none; }
        .task-item { padding: 12px 15px; background: #f9f9f9; margin-bottom: 10px; border-radius: 8px; border: 1px solid #eee; }
        .status { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.85em; margin-right: 10px; }
        .status-done { background: #d5edda; color: #155724; }
        .status-doing { background: #fff3cd; color: #856404; }
        .status-blocked { background: #f8d7da; color: #721c24; }
        .risk-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .risk-table th, .risk-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        .risk-table tr:hover { background-color: #f5f5f5; }
        .tag-high { background: #f8d7da; color: #721c24; padding: 2px 8px; border-radius: 10px; font-size: 0.85em; }
        .next-plan { background: #e8f6f3; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .ai-note { background: #fef9e7; border-left: 4px solid #f1c40f; padding: 15px; margin-top: 25px; font-style: italic; border-radius: 0 8px 8px 0; }
        .expand-detail { color: #3498db; cursor: pointer; font-size: 0.9em; text-decoration: underline; margin-top: 8px; display: inline-block; }
        .detail-content { display: none; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .control-buttons { text-align: right; margin-bottom: 20px; }
        .control-buttons button { background: #3498db; color: white; border: none; padding: 8px 16px; margin-left: 10px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .control-buttons button:hover { background: #2980b9; }
        .loading { text-align: center; padding: 50px; color: #7f8c8d; }
        @media print { .control-buttons { display: none; } }
        .team-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .team-table th, .team-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        .team-table th { background: #f8f9fa; font-weight: 600; color: #2c3e50; }
        .team-table tr:hover { background-color: #f8f9fa; }
        .team-table tr:last-child td { border-bottom: none; }
        .completion-bar { width: 100px; height: 8px; background: #ecf0f1; border-radius: 4px; overflow: hidden; display: inline-block; margin-right: 8px; }
        .completion-fill { height: 100%; border-radius: 4px; transition: width 0.3s ease; }
        .completion-excellent { background: #27ae60; }
        .completion-good { background: #f39c12; }
        .completion-poor { background: #e74c3c; }
        .performance-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 500; }
        .badge-excellent { background: #d5edda; color: #155724; }
        .badge-good { background: #fff3cd; color: #856404; }
        .badge-poor { background: #f8d7da; color: #721c24; }
        .team-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; }
        .team-stat-card { background: #f8fafc; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db; }
        .team-stat-value { font-size: 1.5em; font-weight: bold; color: #2c3e50; }
        .team-stat-desc { font-size: 0.9em; color: #666; margin-top: 5px; }
        .project-item { background: #f9f9f9; padding: 15px; margin-bottom: 12px; border-radius: 8px; border-left: 4px solid #9b59b6; }
        .project-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .project-name { font-weight: 600; font-size: 1.05em; color: #2c3e50; }
        .project-stats { font-size: 0.9em; color: #7f8c8d; }
        .project-progress { width: 100%; height: 10px; background: #ecf0f1; border-radius: 5px; overflow: hidden; margin-top: 8px; }
        .project-progress-fill { height: 100%; background: linear-gradient(90deg, #9b59b6, #8e44ad); transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <h2>ğŸ“Š æ­£åœ¨åŠ è½½å‘¨æŠ¥æ•°æ®...</h2>
        <p>è¯·ç¨å€™ï¼Œæ­£åœ¨ä» report.json è¯»å–æ•°æ®</p>
    </div>
    
    <div class="report-container" id="report-content" style="display: none;">
        <div class="control-buttons">
            <button onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button onclick="exportToPDF()">ğŸ“„ å¯¼å‡ºPDF</button>
        </div>
        
        <header>
            <h1>ğŸ¤– {{team_name}}å¼€å‘å‘¨æŠ¥</h1>
            <p class="meta">ç”Ÿæˆå‘¨æœŸ: <span class="period">{{report_start_date}} è‡³ {{report_end_date}}</span> | ç”Ÿæˆæ—¶é—´: {{generation_time}} | å›¢é˜Ÿ: {{team_name}}</p>
        </header>

        <section class="section">
            <h2>ğŸ“ˆ æ ¸å¿ƒæ•°æ®æ‘˜è¦</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value">{{my_completion_rate}}%</div>
                    <div class="metric-desc">ä»»åŠ¡å®Œæˆç‡ <br><small>({{completed_tasks}}/{{total_tasks}}é¡¹)</small></div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{new_tasks}}</div>
                    <div class="metric-desc">æ–°å¢ä»»åŠ¡æ•°</div>
                </div>
                <div class="metric-card critical">
                    <div class="metric-value">{{overdue_tasks}}</div>
                    <div class="metric-desc">è¶…æ—¶ä»»åŠ¡æ•°</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{in_progress_tasks}}</div>
                    <div class="metric-desc">è¿›è¡Œä¸­ä»»åŠ¡ <br><small>(å¹³å‡è¿›åº¦{{avg_progress}}%)</small></div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{high_priority_tasks}}</div>
                    <div class="metric-desc">é«˜ä¼˜å…ˆçº§ä»»åŠ¡ <br><small>(å®Œæˆç‡{{high_priority_completion_rate}}%)</small></div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{project_count}}</div>
                    <div class="metric-desc">æ¶‰åŠé¡¹ç›®æ•° <br><small>(ä¸»è¦é¡¹ç›®ï¼š{{main_project}})</small></div>
                </div>
            </div>
            <p><strong>âœ¨ æ ¸å¿ƒè¿›å±•ï¼š</strong> {{top_achievement}}</p>
            <p><strong>âš ï¸ å…³é”®é£é™©ï¼š</strong> {{critical_risk}}</p>
            <p><strong>ğŸ“Š ç¯æ¯”æ•°æ®ï¼š</strong> å®Œæˆä»»åŠ¡ç¯æ¯”{{completed_wow}}ï¼Œæ–°å¢ä»»åŠ¡ç¯æ¯”{{new_tasks_wow}}</p>
        </section>

        <section class="section">
            <h2>ğŸ—‚ï¸ æœ¬å‘¨å·¥ä½œè¯¦æƒ…</h2>
            <h3>ğŸ“‹ ä»»åŠ¡åˆ†ç±»ç»Ÿè®¡</h3>
            <ul class="task-list">
                <li class="task-item">
                    <span class="status status-done">âœ… å·²å®Œæˆ</span>
                    <strong>{{completed_tasks}}ä¸ªä»»åŠ¡</strong> - æŒ‰æ—¶å®Œæˆ{{on_time_completed}}ä¸ªï¼Œå»¶æœŸå®Œæˆ{{late_completed}}ä¸ª
                </li>
                <li class="task-item">
                    <span class="status status-doing">ğŸ”„ è¿›è¡Œä¸­</span>
                    <strong>{{in_progress_tasks}}ä¸ªä»»åŠ¡</strong> - å¹³å‡è¿›åº¦{{avg_progress}}%ï¼Œé¢„è®¡å®Œæˆå¤©æ•°{{avg_completion_days}}å¤©
                </li>
                <li class="task-item">
                    <span class="status status-blocked">âš ï¸ è¶…æ—¶ä»»åŠ¡</span>
                    <strong>{{overdue_tasks}}ä¸ªä»»åŠ¡</strong> - å³å°†è¶…æ—¶{{soon_overdue_tasks}}ä¸ª
                </li>
            </ul>

            <h3>ğŸ“Š å›¢é˜Ÿæˆå‘˜è¯¦ç»†è¡¨ç°</h3>
            <div id="team-performance-table">
                <!-- å›¢é˜Ÿè¡¨ç°è¡¨æ ¼å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <section class="section">
            <h2>âš ï¸ é£é™©ä¸é—®é¢˜è·Ÿè¸ª</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value">{{pending_review}}</div>
                    <div class="metric-desc">å¾…å®¡æ ¸ä»»åŠ¡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{approved_tasks}}</div>
                    <div class="metric-desc">å®¡æ ¸é€šè¿‡ä»»åŠ¡</div>
                </div>
                <div class="metric-card critical">
                    <div class="metric-value">{{rejected_tasks}}</div>
                    <div class="metric-desc">å®¡æ ¸é©³å›ä»»åŠ¡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{approval_rate}}%</div>
                    <div class="metric-desc">å®¡æ ¸é€šè¿‡ç‡</div>
                </div>
            </div>
            
            <h3>ğŸ” å­ä»»åŠ¡ç»Ÿè®¡</h3>
            <ul class="task-list">
                <li class="task-item">
                    <strong>çˆ¶ä»»åŠ¡ï¼š</strong>{{parent_tasks}}ä¸ªï¼Œå­ä»»åŠ¡ï¼š{{sub_tasks}}ä¸ªï¼Œå­ä»»åŠ¡å®Œæˆç‡ï¼š{{sub_task_completion_rate}}%
                </li>
            </ul>

            <h3>ğŸ“¦ é¡¹ç›®ä»»åŠ¡åˆ†å¸ƒ</h3>
            <div id="project-distribution">
                <!-- é¡¹ç›®åˆ†å¸ƒå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“… ä¸‹å‘¨æ ¸å¿ƒè®¡åˆ’</h2>
            <div class="next-plan">
                <p><strong>ğŸ“Š ç»Ÿè®¡å‘¨æœŸï¼š</strong>ç¬¬{{report_week}}å‘¨ï¼Œç»Ÿè®¡{{report_days}}å¤©</p>
                <p><strong>ğŸ¯ ä¸‹å‘¨ç›®æ ‡ï¼š</strong>{{next_week_plan}}</p>
                <p><strong>ğŸ“ˆ é¢„æœŸæŒ‡æ ‡ï¼š</strong>{{next_week_targets}}</p>
                <p><strong>âš ï¸ å…³æ³¨é‡ç‚¹ï¼š</strong>{{next_week_focus}}</p>
            </div>
        </section>

        <div class="ai-note">
            <p>ğŸ’¡ æ­¤æŠ¥å‘Šç”± {{system_name}} è‡ªåŠ¨ç”Ÿæˆï¼Œç»Ÿè®¡å‘¨æœŸï¼š{{report_start_date}} è‡³ {{report_end_date}}ã€‚</p>
            <p>ğŸŒ æ•°æ®æ¥æºï¼š{{data_sources}}</p>
            <p>ğŸ“ å¤‡æ³¨ï¼š{{report_notes}}</p>

        </div>
    </div>

    <script>
        // åˆ‡æ¢è¯¦æƒ…æ˜¾ç¤º
        function toggleDetail(element) {
            const detail = element.nextElementSibling;
            const isHidden = detail.style.display === 'none' || detail.style.display === '';
            detail.style.display = isHidden ? 'block' : 'none';
            element.textContent = isHidden ? 'æ”¶èµ·è¯¦æƒ…' : 'æŸ¥çœ‹è¯¦æƒ…';
        }

        // ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®å¹¶æ¸²æŸ“æ¨¡æ¿
        async function loadReportData() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('loading').style.display = 'block';
                document.getElementById('report-content').style.display = 'none';
                
                // ç”±äºCORSé™åˆ¶ï¼Œæˆ‘ä»¬å°†æ•°æ®ç›´æ¥åµŒå…¥åˆ°HTMLä¸­
                const jsonData = {
                    "template_config": {
                        "template_name": "AIæ¡Œå® é¡¹ç›®ç»„å‘¨æŠ¥æ¨¡æ¿",
                        "template_version": "v1.0",
                        "description": "åŸºäºTaskInformationå®ä½“ç±»çš„AIå‘¨æŠ¥æ¨¡æ¿ - è™šæ‹Ÿæµ‹è¯•æ•°æ®",
                        "last_updated": "2026-01-15"
                    },
                    "report_data": {
                        "team_name": "AIæ¡Œå® é¡¹ç›®ç»„",
                        "report_start_date": "2026-01-08",
                        "report_end_date": "2026-01-14",
                        "generation_time": "2026-01-15 10:30:00",
                        "report_week": 3,
                        "report_days": 7,
                        "total_tasks": 28,
                        "completed_tasks": 22,
                        "new_tasks": 6,
                        "in_progress_tasks": 4,
                        "not_started_tasks": 2,
                        "overdue_tasks": 3,
                        "soon_overdue_tasks": 1,
                        "on_time_completed": 18,
                        "late_completed": 4,
                        "progress_0_25": 2,
                        "progress_26_50": 1,
                        "progress_51_75": 2,
                        "progress_76_99": 1,
                        "progress_100": 22,
                        "avg_progress": 82.5,
                        "avg_completion_days": 4.2,
                        "high_priority_tasks": 8,
                        "medium_priority_tasks": 12,
                        "low_priority_tasks": 8,
                        "high_priority_completed": 7,
                        "high_priority_completion_rate": 87.5,
                        "my_tasks": 12,
                        "my_completed": 10,
                        "my_completion_rate": 83.3,
                        "my_overdue": 1,
                        "team_members": 6,
                        "top_performer": "å¼ ä¸‰",
                        "top_performer_count": 8,
                        "project_count": 3,
                        "main_project": "AIæ¡Œå® æ ¸å¿ƒåŠŸèƒ½",
                        "main_project_tasks": 15,
                        "parent_tasks": 8,
                        "sub_tasks": 20,
                        "sub_task_completion_rate": 85.0,
                        "pending_review": 2,
                        "approved_tasks": 18,
                        "rejected_tasks": 3,
                        "approval_rate": 85.7,
                        "completed_wow": "+15%",
                        "new_tasks_wow": "-8%",
                        "overdue_wow": "+2%",
                        "top_achievement": "AIå¯¹è¯å¼•æ“æ ¸å¿ƒé€»è¾‘å®Œæˆé‡æ„ï¼Œå“åº”é€Ÿåº¦æå‡40%ï¼Œç”¨æˆ·æ»¡æ„åº¦æ˜¾è‘—æå‡",
                        "critical_risk": "ç¬¬ä¸‰æ–¹é£ä¹¦APIæ¥å£é¢‘æ¬¡é™åˆ¶ï¼Œå¯èƒ½å½±å“ä¸‹å‘¨ä»»åŠ¡åŒæ­¥ç¨³å®šæ€§ï¼Œéœ€è¦å¯»æ‰¾å¤‡ç”¨æ–¹æ¡ˆ",
                        "next_week_plan": "1. è§£å†³é£ä¹¦APIé™åˆ¶é—®é¢˜ 2. å®Œæˆç¼“å­˜æœºåˆ¶ä¼˜åŒ– 3. å¯åŠ¨æ–°åŠŸèƒ½æ¨¡å—å¼€å‘",
                        "next_week_targets": "å®Œæˆç‡ç›®æ ‡90%ï¼Œæ–°å¢ä»»åŠ¡æ§åˆ¶åœ¨5ä¸ªä»¥å†…ï¼Œè¶…æ—¶ä»»åŠ¡é™è‡³1ä¸ª",
                        "next_week_focus": "é‡ç‚¹å…³æ³¨APIç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œç¡®ä¿æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œ",
                        "system_name": "AIæ¡Œå® ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ",
                        "data_sources": "ä»»åŠ¡ç®¡ç†ç³»ç»Ÿæ•°æ®åº“ã€é¡¹ç›®ç®¡ç†å¹³å°ã€ä»£ç ä»“åº“ç»Ÿè®¡",
                        "report_notes": "æœ¬æŠ¥å‘Šæ•°æ®ç»Ÿè®¡æ—¶é—´æˆªæ­¢åˆ°2026-01-15 10:30:00ï¼ŒåŒ…å«æ‰€æœ‰æœ‰æ•ˆä»»åŠ¡æ•°æ®"
                    },
                    "chart_data": {
                        "task_completion_trend": [
                            {"date": "2026-01-08", "completed": 3, "new": 2},
                            {"date": "2026-01-09", "completed": 4, "new": 1},
                            {"date": "2026-01-10", "completed": 3, "new": 1},
                            {"date": "2026-01-11", "completed": 2, "new": 0},
                            {"date": "2026-01-12", "completed": 4, "new": 1},
                            {"date": "2026-01-13", "completed": 3, "new": 1},
                            {"date": "2026-01-14", "completed": 3, "new": 0}
                        ],
                        "priority_distribution": [
                            {"priority": "é«˜", "count": 8, "completed": 7},
                            {"priority": "ä¸­", "count": 12, "completed": 10},
                            {"priority": "ä½", "count": 8, "completed": 5}
                        ],
                        "project_distribution": [
                            {"project": "AIæ¡Œå® æ ¸å¿ƒåŠŸèƒ½", "tasks": 15, "completed": 12},
                            {"project": "ç”¨æˆ·ç•Œé¢ä¼˜åŒ–", "tasks": 8, "completed": 6},
                            {"project": "ç³»ç»Ÿé›†æˆæµ‹è¯•", "tasks": 5, "completed": 4}
                        ]
                    },
                    "team_performance": [
                        {"name": "å¼ ä¸‰", "tasks": 8, "completed": 8, "completion_rate": 100},
                        {"name": "æå››", "tasks": 6, "completed": 5, "completion_rate": 83.3},
                        {"name": "ç‹äº”", "tasks": 5, "completed": 4, "completion_rate": 80},
                        {"name": "èµµå…­", "tasks": 4, "completed": 3, "completion_rate": 75},
                        {"name": "é’±ä¸ƒ", "tasks": 3, "completed": 2, "completion_rate": 66.7},
                        {"name": "å­™å…«", "tasks": 2, "completed": 0, "completion_rate": 0}
                    ],
                    "detailed_notes": {
                        "highlights": [
                            "å¼ ä¸‰æœ¬å‘¨è¡¨ç°ä¼˜å¼‚ï¼Œå®Œæˆç‡100%ï¼Œæ‰€æœ‰ä»»åŠ¡å‡æŒ‰æ—¶äº¤ä»˜",
                            "æå››åœ¨AIå¯¹è¯å¼•æ“é‡æ„ä¸­å‘æŒ¥å…³é”®ä½œç”¨ï¼ŒæŠ€æœ¯æ”»å…³èƒ½åŠ›çªå‡º",
                            "ç‹äº”é‡åˆ°ç¬¬ä¸‰æ–¹APIé™åˆ¶é—®é¢˜ï¼Œå·²ç§¯æå¯»æ±‚è§£å†³æ–¹æ¡ˆ"
                        ],
                        "concerns": [
                            "å­™å…«æœ¬å‘¨ä»»åŠ¡å®Œæˆç‡ä¸º0ï¼Œéœ€è¦å…³æ³¨å¹¶æä¾›æ”¯æŒ",
                            "éƒ¨åˆ†æˆå‘˜åœ¨é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸ŠæŠ•å…¥ä¸è¶³ï¼Œéœ€è¦è°ƒæ•´å·¥ä½œé‡å¿ƒ"
                        ]
                    }
                };
                
                const reportData = jsonData.report_data;
                
                // æ¸²æŸ“æ¨¡æ¿
                renderTemplate(reportData);
                
                // æ¸²æŸ“å›¾è¡¨æ•°æ®
                if (jsonData.chart_data) {
                    renderCharts(jsonData.chart_data);
                }
                
                // æ¸²æŸ“å›¢é˜Ÿè¡¨ç°
                if (jsonData.team_performance) {
                    renderTeamPerformance(jsonData.team_performance);
                }
                
                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºæŠ¥å‘Šå†…å®¹
                document.getElementById('loading').style.display = 'none';
                document.getElementById('report-content').style.display = 'block';
                
                console.log('å‘¨æŠ¥æ•°æ®åŠ è½½æˆåŠŸ:', reportData);
                
            } catch (error) {
                console.error('åŠ è½½æŠ¥å‘Šæ•°æ®å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = '<div style="text-align:center;padding:50px;color:#e74c3c;"><h2>âŒ æ•°æ®åŠ è½½å¤±è´¥</h2><p>é”™è¯¯ä¿¡æ¯: ' + error.message + '</p><button onclick="loadReportData()" style="background:#e74c3c;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;">é‡æ–°åŠ è½½</button></div>';
            }
        }

        // æ¨¡æ¿æ¸²æŸ“å‡½æ•°
        function renderTemplate(data) {
            // è·å–æ‰€æœ‰åŒ…å«å˜é‡çš„å…ƒç´ 
            const elements = document.querySelectorAll('*');
            
            elements.forEach(element => {
                // å¤„ç†æ–‡æœ¬å†…å®¹ä¸­çš„å˜é‡
                if (element.childNodes.length > 0) {
                    element.childNodes.forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            let text = node.textContent;
                            // æ›¿æ¢æ‰€æœ‰ {{variable}} æ ¼å¼çš„å˜é‡
                            text = text.replace(/\{\{(\w+)\}\}/g, (match, key) => {
                                return data[key] !== undefined ? data[key] : match;
                            });
                            node.textContent = text;
                        }
                    });
                }
                
                // å¤„ç†å±æ€§ä¸­çš„å˜é‡ï¼ˆå¦‚titleç­‰ï¼‰
                if (element.attributes) {
                    Array.from(element.attributes).forEach(attr => {
                        let value = attr.value;
                        value = value.replace(/\{\{(\w+)\}\}/g, (match, key) => {
                            return data[key] !== undefined ? data[key] : match;
                        });
                        attr.value = value;
                    });
                }
            });
        }

        // æ¸²æŸ“å›¾è¡¨æ•°æ®ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦å›¾è¡¨å±•ç¤ºï¼‰
        function renderCharts(chartData) {
            console.log('å›¾è¡¨æ•°æ®:', chartData);
            
            // æ¸²æŸ“é¡¹ç›®åˆ†å¸ƒ
            if (chartData.project_distribution) {
                renderProjectDistribution(chartData.project_distribution);
            }
        }

        // æ¸²æŸ“é¡¹ç›®åˆ†å¸ƒ
        function renderProjectDistribution(projectData) {
            const container = document.getElementById('project-distribution');
            if (!container || !projectData || projectData.length === 0) {
                return;
            }

            let html = '';
            projectData.forEach((project, index) => {
                const completionRate = (project.completed / project.tasks * 100).toFixed(1);
                const inProgress = project.tasks - project.completed;
                
                // é¡¹ç›®é¢œè‰²
                const colors = ['#9b59b6', '#3498db', '#e74c3c', '#f39c12', '#27ae60'];
                const color = colors[index % colors.length];

                html += `
                    <div class="project-item" style="border-left-color: ${color};">
                        <div class="project-header">
                            <div class="project-name">ğŸ“ ${project.project}</div>
                            <div class="project-stats">
                                <span style="color: #27ae60; font-weight: 600;">âœ“ ${project.completed}</span> / 
                                <span style="color: #7f8c8d;">${project.tasks} ä»»åŠ¡</span> | 
                                <span style="color: #f39c12;">è¿›è¡Œä¸­ ${inProgress}</span>
                            </div>
                        </div>
                        <div class="project-progress">
                            <div class="project-progress-fill" style="width: ${completionRate}%; background: ${color};"></div>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.85em; color: #7f8c8d;">
                            å®Œæˆç‡: <strong style="color: ${color};">${completionRate}%</strong>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            console.log('é¡¹ç›®åˆ†å¸ƒæ¸²æŸ“å®Œæˆ');
        }

        // æ¸²æŸ“å›¢é˜Ÿè¡¨ç°æ•°æ®
        function renderTeamPerformance(teamData) {
            const container = document.getElementById('team-performance-table');
            if (!container || !teamData || teamData.length === 0) {
                return;
            }

            // è®¡ç®—å›¢é˜Ÿç»Ÿè®¡æ•°æ®
            const totalTasks = teamData.reduce((sum, member) => sum + member.tasks, 0);
            const totalCompleted = teamData.reduce((sum, member) => sum + member.completed, 0);
            const avgCompletionRate = (totalCompleted / totalTasks * 100).toFixed(1);
            const activeMembers = teamData.filter(m => m.tasks > 0).length;

            // åˆ›å»ºå›¢é˜Ÿç»Ÿè®¡å¡ç‰‡
            const statsHtml = `
                <div class="team-stats">
                    <div class="team-stat-card">
                        <div class="team-stat-value">${activeMembers}</div>
                        <div class="team-stat-desc">æ´»è·ƒæˆå‘˜æ•°</div>
                    </div>
                    <div class="team-stat-card">
                        <div class="team-stat-value">${totalTasks}</div>
                        <div class="team-stat-desc">å›¢é˜Ÿæ€»ä»»åŠ¡æ•°</div>
                    </div>
                    <div class="team-stat-card">
                        <div class="team-stat-value">${totalCompleted}</div>
                        <div class="team-stat-desc">å›¢é˜Ÿå®Œæˆä»»åŠ¡æ•°</div>
                    </div>
                    <div class="team-stat-card">
                        <div class="team-stat-value">${avgCompletionRate}%</div>
                        <div class="team-stat-desc">å›¢é˜Ÿå¹³å‡å®Œæˆç‡</div>
                    </div>
                </div>
            `;

            // åˆ›å»ºè¡¨æ ¼
            let tableHtml = `
                ${statsHtml}
                <table class="team-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>æˆå‘˜å§“å</th>
                            <th>è´Ÿè´£ä»»åŠ¡æ•°</th>
                            <th>å·²å®Œæˆ</th>
                            <th>è¿›è¡Œä¸­</th>
                            <th>å®Œæˆç‡</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // æŒ‰å®Œæˆç‡æ’åº
            const sortedTeam = [...teamData].sort((a, b) => b.completion_rate - a.completion_rate);

            sortedTeam.forEach((member, index) => {
                const inProgress = member.tasks - member.completed;
                const completionRate = member.completion_rate;
                
                // ç¡®å®šå®Œæˆç‡é¢œè‰²
                let fillClass = 'completion-poor';
                
                if (completionRate >= 80) {
                    fillClass = 'completion-excellent';
                } else if (completionRate >= 60) {
                    fillClass = 'completion-good';
                }

                // æ·»åŠ æ’åå›¾æ ‡
                let rankIcon = '';
                if (index === 0) rankIcon = 'ğŸ¥‡';
                else if (index === 1) rankIcon = 'ğŸ¥ˆ';
                else if (index === 2) rankIcon = 'ğŸ¥‰';
                else rankIcon = `${index + 1}`;

                tableHtml += `
                    <tr>
                        <td style="font-weight: bold; font-size: 1.1em;">${rankIcon}</td>
                        <td><strong>${member.name}</strong></td>
                        <td>${member.tasks}</td>
                        <td style="color: #27ae60; font-weight: 600;">${member.completed}</td>
                        <td style="color: #f39c12;">${inProgress}</td>
                        <td>
                            <div class="completion-bar">
                                <div class="completion-fill ${fillClass}" style="width: ${completionRate}%"></div>
                            </div>
                            <span style="font-weight: 600;">${completionRate.toFixed(1)}%</span>
                        </td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHtml;
            console.log('å›¢é˜Ÿè¡¨ç°æ•°æ®æ¸²æŸ“å®Œæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadReportData();
        });

        // å¯¼å‡ºPDFåŠŸèƒ½
        function exportToPDF() {
            window.print();
        }

        // åˆ·æ–°æ•°æ®åŠŸèƒ½
        function refreshData() {
            loadReportData();
        }
    </script>
</body>
</html>